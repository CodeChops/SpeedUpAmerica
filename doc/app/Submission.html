<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class Submission - Rails Application Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">ActiveRecord::Base
  
</div>

    
    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">ActionView::Helpers::NumberHelper</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-amount_to_percentage">::amount_to_percentage</a>
    
    <li ><a href="#method-c-average_speed_by_zipcode">::average_speed_by_zipcode</a>
    
    <li ><a href="#method-c-category_name">::category_name</a>
    
    <li ><a href="#method-c-census_tract_url">::census_tract_url</a>
    
    <li ><a href="#method-c-count_between">::count_between</a>
    
    <li ><a href="#method-c-create_submission">::create_submission</a>
    
    <li ><a href="#method-c-fetch_mapbox_data">::fetch_mapbox_data</a>
    
    <li ><a href="#method-c-filter_rating">::filter_rating</a>
    
    <li ><a href="#method-c-filter_satisfaction">::filter_satisfaction</a>
    
    <li ><a href="#method-c-get_all_results">::get_all_results</a>
    
    <li ><a href="#method-c-get_date_ranges">::get_date_ranges</a>
    
    <li ><a href="#method-c-get_location_data">::get_location_data</a>
    
    <li ><a href="#method-c-get_satisfaction">::get_satisfaction</a>
    
    <li ><a href="#method-c-int_to_ip">::int_to_ip</a>
    
    <li ><a href="#method-c-internet_stats_data">::internet_stats_data</a>
    
    <li ><a href="#method-c-isps_tests_data">::isps_tests_data</a>
    
    <li ><a href="#method-c-map_range_values">::map_range_values</a>
    
    <li ><a href="#method-c-median">::median</a>
    
    <li ><a href="#method-c-median_speed_with_range">::median_speed_with_range</a>
    
    <li ><a href="#method-c-mobile_service_providers_data">::mobile_service_providers_data</a>
    
    <li ><a href="#method-c-percentage">::percentage</a>
    
    <li ><a href="#method-c-provider_mapping">::provider_mapping</a>
    
    <li ><a href="#method-c-provider_names">::provider_names</a>
    
    <li ><a href="#method-c-satisfactions_mapping">::satisfactions_mapping</a>
    
    <li ><a href="#method-c-search">::search</a>
    
    <li ><a href="#method-c-service_providers_data">::service_providers_data</a>
    
    <li ><a href="#method-c-service_providers_satisfactions_data">::service_providers_satisfactions_data</a>
    
    <li ><a href="#method-c-service_providers_usage_data">::service_providers_usage_data</a>
    
    <li ><a href="#method-c-set_color">::set_color</a>
    
    <li ><a href="#method-c-set_mapbox_census_data">::set_mapbox_census_data</a>
    
    <li ><a href="#method-c-set_mapbox_gl_data">::set_mapbox_gl_data</a>
    
    <li ><a href="#method-c-set_mapbox_markers_data">::set_mapbox_markers_data</a>
    
    <li ><a href="#method-c-set_mapbox_polygon_data">::set_mapbox_polygon_data</a>
    
    <li ><a href="#method-c-set_stats_color">::set_stats_color</a>
    
    <li ><a href="#method-c-speed_attribute">::speed_attribute</a>
    
    <li ><a href="#method-c-speed_breakdown_data">::speed_breakdown_data</a>
    
    <li ><a href="#method-c-speed_comparison_data">::speed_comparison_data</a>
    
    <li ><a href="#method-c-stats_data">::stats_data</a>
    
    <li ><a href="#method-c-testing_for_mapping">::testing_for_mapping</a>
    
    <li ><a href="#method-c-tests_count_with_range">::tests_count_with_range</a>
    
    <li ><a href="#method-c-to_csv">::to_csv</a>
    
    <li ><a href="#method-c-zip_json_url">::zip_json_url</a>
    
    <li ><a href="#method-i-calculate_average">#calculate_average</a>
    
    <li ><a href="#method-i-get_actual_to_provider_difference">#get_actual_to_provider_difference</a>
    
    <li ><a href="#method-i-get_provider">#get_provider</a>
    
    <li ><a href="#method-i-has_required_fields-3F">#has_required_fields?</a>
    
    <li ><a href="#method-i-invalid_test_result">#invalid_test_result</a>
    
    <li ><a href="#method-i-set_census_code">#set_census_code</a>
    
    <li ><a href="#method-i-source">#source</a>
    
    <li ><a href="#method-i-update_median_speeds_and_census">#update_median_speeds_and_census</a>
    
    <li ><a href="#method-i-update_provider_statistics">#update_provider_statistics</a>
    
    <li ><a href="#method-i-valid_attributes-3F">#valid_attributes?</a>
    
    <li ><a href="#method-i-valid_zip_code-3F">#valid_zip_code?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Submission">
  <h1 id="class-Submission" class="class">
    class Submission
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="CENSUS_CODES">CENSUS_CODES
        
        <dd>
        
      
        <dt id="CENSUS_STATUS">CENSUS_STATUS
        
        <dd>
        
      
        <dt id="CSV_COLUMNS">CSV_COLUMNS
        
        <dd>
        
      
        <dt id="MAP_FILTERS">MAP_FILTERS
        
        <dd>
        
      
        <dt id="MOBILE_MAXIMUM_SPEED">MOBILE_MAXIMUM_SPEED
        
        <dd>
        
      
        <dt id="UAIs">UAIs
        
        <dd>
        
      
        <dt id="ZIP_CODES">ZIP_CODES
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-amount_to_percentage" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">amount_to_percentage</span><span
            class="method-args">(amount)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="amount_to_percentage-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 468</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">amount_to_percentage</span>(<span class="ruby-identifier">amount</span>)
  <span class="ruby-identifier">amount</span> <span class="ruby-operator">*</span> <span class="ruby-value">100</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-average_speed_by_zipcode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">average_speed_by_zipcode</span><span
            class="method-args">(submissions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="average_speed_by_zipcode-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 627</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">average_speed_by_zipcode</span>(<span class="ruby-identifier">submissions</span>)
  <span class="ruby-identifier">average_speeds</span> = {}
  <span class="ruby-identifier">zip_codes</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:zip_code</span>).<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">zip_codes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">zip_code</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">zip_code_submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">zip_code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip_code</span>)
    <span class="ruby-identifier">average</span> = (<span class="ruby-identifier">zip_code_submissions</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:actual_down_speed</span>).<span class="ruby-identifier">sum</span><span class="ruby-operator">/</span><span class="ruby-identifier">zip_code_submissions</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
    <span class="ruby-identifier">average_speeds</span>[<span class="ruby-identifier">zip_code</span>] = <span class="ruby-identifier">average</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">average_speeds</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-category_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">category_name</span><span
            class="method-args">(date, period)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="category_name-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 569</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">category_name</span>(<span class="ruby-identifier">date</span>, <span class="ruby-identifier">period</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">period</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;day&#39;</span>
    [<span class="ruby-identifier">date</span>.<span class="ruby-identifier">day</span>, <span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%B&#39;</span>)].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">period</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;month&#39;</span>
    [<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%B&#39;</span>), <span class="ruby-identifier">date</span>.<span class="ruby-identifier">year</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">period</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;year&#39;</span>
    <span class="ruby-identifier">date</span>.<span class="ruby-identifier">year</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-census_tract_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">census_tract_url</span><span
            class="method-args">(lat, long)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="census_tract_url-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 286</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">census_tract_url</span>(<span class="ruby-identifier">lat</span>, <span class="ruby-identifier">long</span>)
  <span class="ruby-node">&quot;http://data.fcc.gov/api/block/find?format=json&amp;latitude=#{lat}&amp;longitude=#{long}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-count_between" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">count_between</span><span
            class="method-args">(submissions, range, test_type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="count_between-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 488</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">count_between</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">test_type</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-string">&#39;+&#39;</span>.<span class="ruby-identifier">in?</span>(<span class="ruby-identifier">range</span>)
    <span class="ruby-identifier">lower</span> = <span class="ruby-identifier">range</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;+&#39;</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">to_f</span>
    <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{attribute_name} &gt;= ?&quot;</span>, <span class="ruby-identifier">lower</span>).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">range_values</span> = <span class="ruby-identifier">range</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;..&#39;</span>)
    <span class="ruby-identifier">lower</span> = <span class="ruby-identifier">range_values</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_f</span>
    <span class="ruby-identifier">upper</span> = <span class="ruby-identifier">range_values</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_f</span>
    <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{attribute_name}&quot;</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">lower</span><span class="ruby-operator">..</span><span class="ruby-identifier">upper</span>]).<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-create_submission" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_submission</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_submission-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create_submission</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">duplicate_ipa_tests</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&#39;DATE(created_at) = ? AND ip_address = ?&#39;</span>, <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:ip_address</span>])

  <span class="ruby-identifier">submission</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">monthly_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider_down_speed</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">actual_down_speed</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider_price</span> = <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">monthly_price</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider_down_speed</span>
    <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">actual_price</span> = <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">monthly_price</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">actual_down_speed</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">test_type</span> = <span class="ruby-string">&#39;duplicate&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">duplicate_ipa_tests</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">completed</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">valid_attributes?</span>
  <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">test_id</span> = [<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">hex</span>(<span class="ruby-value">10</span>)].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;_&#39;</span>)
  <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider</span> = <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">get_provider</span>
  <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">submission</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-fetch_mapbox_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fetch_mapbox_data</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="fetch_mapbox_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">fetch_mapbox_data</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_by</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:group_by</span>][<span class="ruby-value">:zip_code</span>]
    <span class="ruby-identifier">set_mapbox_polygon_data</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_by</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:group_by</span>][<span class="ruby-value">:census_tract</span>]
    <span class="ruby-identifier">set_mapbox_census_data</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_by</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:group_by</span>][<span class="ruby-value">:individual_responses</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:is_ie</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;no&#39;</span>
    <span class="ruby-identifier">set_mapbox_gl_data</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_by</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:group_by</span>][<span class="ruby-value">:individual_responses</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:is_ie</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;yes&#39;</span>
    <span class="ruby-identifier">set_mapbox_markers_data</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-filter_rating" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_rating</span><span
            class="method-args">(rating)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filter_rating-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 464</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">filter_rating</span>(<span class="ruby-identifier">rating</span>)
  (<span class="ruby-identifier">rating</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>).<span class="ruby-identifier">ceil</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-filter_satisfaction" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_satisfaction</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filter_satisfaction-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 371</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">filter_satisfaction</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;All&#39;</span> <span class="ruby-keyword">then</span> <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Negative&#39;</span> <span class="ruby-keyword">then</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">3</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Neutral&#39;</span> <span class="ruby-keyword">then</span> <span class="ruby-value">3</span><span class="ruby-operator">...</span><span class="ruby-value">5</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Positive&#39;</span> <span class="ruby-keyword">then</span> <span class="ruby-value">5</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_all_results" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_all_results</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_all_results-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_all_results</span>
  <span class="ruby-identifier">all_results</span> = {}

  <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">not_empty</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider_statistic</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">provider_name</span> = <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">name</span>
    <span class="ruby-identifier">all_results</span>[<span class="ruby-identifier">provider_name</span>] = {}
    <span class="ruby-identifier">all_results</span>[<span class="ruby-identifier">provider_name</span>][<span class="ruby-string">&#39;count&#39;</span>] = <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">applications</span>
    <span class="ruby-identifier">all_results</span>[<span class="ruby-identifier">provider_name</span>][<span class="ruby-string">&#39;rating&#39;</span>] = <span class="ruby-identifier">filter_rating</span>(<span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">rating</span>)
    <span class="ruby-identifier">all_results</span>[<span class="ruby-identifier">provider_name</span>][<span class="ruby-string">&#39;ratio&#39;</span>] = <span class="ruby-identifier">amount_to_percentage</span>(<span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">advertised_to_actual_ratio</span>)
    <span class="ruby-identifier">all_results</span>[<span class="ruby-identifier">provider_name</span>][<span class="ruby-string">&#39;cost&#39;</span>] = <span class="ruby-string">&#39;%.2f&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">average_price</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">all_results</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_date_ranges" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_date_ranges</span><span
            class="method-args">(statistics, start_date, end_date)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_date_ranges-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 537</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_date_ranges</span>(<span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>)
  <span class="ruby-identifier">period</span> = <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:period</span>].<span class="ruby-identifier">downcase</span>
  <span class="ruby-identifier">time_intervals</span> = [{ <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">category_name</span>(<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">period</span>), <span class="ruby-identifier">range</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;end_of_#{period}&quot;</span>)] }]

  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">end_date</span>.<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">period</span>)
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;end_of_#{period}&quot;</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_date</span>

    <span class="ruby-identifier">range</span> = [<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;beginning_of_#{period}&quot;</span>), <span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;end_of_#{period}&quot;</span>)]
    <span class="ruby-identifier">time_intervals</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">category_name</span>(<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">period</span>), <span class="ruby-identifier">range</span><span class="ruby-operator">:</span> <span class="ruby-identifier">range</span> }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">time_intervals</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">category_name</span>(<span class="ruby-identifier">end_date</span>, <span class="ruby-identifier">period</span>), <span class="ruby-identifier">range</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">end_date</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;beginning_of_#{period}&quot;</span>), <span class="ruby-identifier">end_date</span>] }

  <span class="ruby-identifier">time_intervals</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_location_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_location_data</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_location_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 393</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_location_data</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">geocoder</span> = <span class="ruby-constant">Geocoder</span>.<span class="ruby-identifier">search</span>(<span class="ruby-node">&quot;#{params[:latitude]}, #{params[:longitude]}&quot;</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">data</span> =  {
            <span class="ruby-string">&#39;address&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">geocoder</span>.<span class="ruby-identifier">address</span>,
            <span class="ruby-string">&#39;zip_code&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">geocoder</span>.<span class="ruby-identifier">postal_code</span>,
          }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_satisfaction" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_satisfaction</span><span
            class="method-args">(satisfaction)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_satisfaction-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 380</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_satisfaction</span>(<span class="ruby-identifier">satisfaction</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">satisfaction</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">3</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;Negative&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">3</span><span class="ruby-operator">...</span><span class="ruby-value">5</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;Neutral&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">5</span><span class="ruby-operator">..</span><span class="ruby-value">7</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;Positive&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-int_to_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">int_to_ip</span><span
            class="method-args">(num)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="int_to_ip-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 721</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">int_to_ip</span>(<span class="ruby-identifier">num</span>)
  <span class="ruby-constant">IPAddress</span>(<span class="ruby-identifier">num</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">address</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-internet_stats_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">internet_stats_data</span><span
            class="method-args">(statistics)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="internet_stats_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 600</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">internet_stats_data</span>(<span class="ruby-identifier">statistics</span>)
  <span class="ruby-identifier">date_range</span> = <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:date_range</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; - &#39;</span>)
  <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">0</span>]), <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">1</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:provider</span>] = <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:provider</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]
  <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:zip_code</span>] = <span class="ruby-constant">ZIP_CODES</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:zip_code</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]
  <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:census_code</span>] = <span class="ruby-constant">CENSUS_CODES</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:census_code</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]
  <span class="ruby-identifier">providers</span> = <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:provider</span>]).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:name</span>)
  <span class="ruby-identifier">date_ranges</span> = <span class="ruby-identifier">get_date_ranges</span>(<span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>)
  <span class="ruby-identifier">categories</span> = <span class="ruby-identifier">date_ranges</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">range</span><span class="ruby-operator">|</span> <span class="ruby-identifier">range</span>[<span class="ruby-value">:name</span>] }

  <span class="ruby-identifier">submissions</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_zip_code_list</span>
  <span class="ruby-identifier">total_tests</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">in_zip_code_list</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_test_type</span>(<span class="ruby-identifier">statistics</span>[<span class="ruby-value">:test_type</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:test_type</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_zip_code</span>(<span class="ruby-identifier">statistics</span>[<span class="ruby-value">:zip_code</span>])
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_census_code</span>(<span class="ruby-identifier">statistics</span>[<span class="ruby-value">:census_code</span>])
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">provider</span><span class="ruby-operator">:</span> <span class="ruby-identifier">providers</span>)

  {
    <span class="ruby-identifier">speed_comparison_data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">speed_comparison_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:test_type</span>]),
    <span class="ruby-identifier">speed_breakdown_chart_data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">speed_breakdown_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">providers</span>),
    <span class="ruby-identifier">median_speed_chart_data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">isps_tests_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">providers</span>, <span class="ruby-identifier">date_ranges</span>, <span class="ruby-identifier">categories</span>)[<span class="ruby-value">:median_data</span>],
    <span class="ruby-identifier">tests_count_data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">isps_tests_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">providers</span>, <span class="ruby-identifier">date_ranges</span>, <span class="ruby-identifier">categories</span>)[<span class="ruby-value">:tests_count_data</span>],
    <span class="ruby-identifier">total_tests</span><span class="ruby-operator">:</span> <span class="ruby-identifier">total_tests</span>,
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-isps_tests_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">isps_tests_data</span><span
            class="method-args">(submissions, statistics, providers, date_ranges, categories)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="isps_tests_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 579</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">isps_tests_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">providers</span>, <span class="ruby-identifier">date_ranges</span>, <span class="ruby-identifier">categories</span>)
  <span class="ruby-identifier">median_speed_series</span> = []
  <span class="ruby-identifier">tests_count_series</span> = []

  <span class="ruby-identifier">providers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">median_speed_values</span> = []
    <span class="ruby-identifier">tests_count_values</span> = []
    <span class="ruby-identifier">date_ranges</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date_range</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">median_speed_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">median_speed_with_range</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">date_range</span>[<span class="ruby-value">:range</span>], <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:test_type</span>]).<span class="ruby-identifier">to_f</span>
      <span class="ruby-identifier">tests_count_values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tests_count_with_range</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">date_range</span>[<span class="ruby-value">:range</span>], <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:test_type</span>]).<span class="ruby-identifier">to_f</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">median_speed_series</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">median_speed_values</span> }
    <span class="ruby-identifier">tests_count_series</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tests_count_values</span> }
  <span class="ruby-keyword">end</span>

  {
    <span class="ruby-identifier">median_data</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">categories</span><span class="ruby-operator">:</span> <span class="ruby-identifier">categories</span>, <span class="ruby-identifier">series</span><span class="ruby-operator">:</span> <span class="ruby-identifier">median_speed_series</span> },
    <span class="ruby-identifier">tests_count_data</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">categories</span><span class="ruby-operator">:</span> <span class="ruby-identifier">categories</span>, <span class="ruby-identifier">series</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tests_count_series</span> },
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-map_range_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">map_range_values</span><span
            class="method-args">(range)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="map_range_values-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 472</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">map_range_values</span>(<span class="ruby-identifier">range</span>)
  {
    <span class="ruby-string">&#39;0..5.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;0 to 5 Mbps&#39;</span>,
    <span class="ruby-string">&#39;6..10.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;6 to 10 Mbps&#39;</span>,
    <span class="ruby-string">&#39;11..20.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;11-20 Mbps&#39;</span>,
    <span class="ruby-string">&#39;21..40.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;21-40 Mbps&#39;</span>,
    <span class="ruby-string">&#39;40..60.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;40-60 Mbps&#39;</span>,
    <span class="ruby-string">&#39;61..80.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;61-80 Mbps&#39;</span>,
    <span class="ruby-string">&#39;81..100.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;81-100 Mbps&#39;</span>,
    <span class="ruby-string">&#39;101..250.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;101-250 Mbps&#39;</span>,
    <span class="ruby-string">&#39;251..500.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;251-500 Mbps&#39;</span>,
    <span class="ruby-string">&#39;500..1000.99&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;500-1000 Mbps&#39;</span>,
    <span class="ruby-string">&#39;1001+&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;1001 Mbps+&#39;</span>,
  }[<span class="ruby-identifier">range</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-median" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">median</span><span
            class="method-args">(array)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="median-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 290</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">median</span>(<span class="ruby-identifier">array</span>)
  <span class="ruby-identifier">sorted</span> = <span class="ruby-identifier">array</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort</span>
  <span class="ruby-identifier">len</span> = <span class="ruby-identifier">sorted</span>.<span class="ruby-identifier">length</span>
  ((<span class="ruby-identifier">sorted</span>[(<span class="ruby-identifier">len</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-operator">/</span> <span class="ruby-value">2</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">sorted</span>[<span class="ruby-identifier">len</span> <span class="ruby-operator">/</span> <span class="ruby-value">2</span>]) <span class="ruby-operator">/</span> <span class="ruby-value">2.0</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">4</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">sorted</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-median_speed_with_range" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">median_speed_with_range</span><span
            class="method-args">(submissions, provider, range, test_type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="median_speed_with_range-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 559</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">median_speed_with_range</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-identifier">range</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">range</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">provider</span>)
  <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">median</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:&quot;#{attribute_name}&quot;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-mobile_service_providers_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mobile_service_providers_data</span><span
            class="method-args">(categories, connection_type, type, submissions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mobile_service_providers_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 682</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">mobile_service_providers_data</span>(<span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">submissions</span>)
  <span class="ruby-identifier">values</span> = []
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-identifier">connection_type</span>)

  <span class="ruby-identifier">categories</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">category</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;mobile_isps_speeds&#39;</span>
      <span class="ruby-identifier">provider_submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">category</span>)
      <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">provider_submissions</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:actual_down_speed</span>).<span class="ruby-identifier">sum</span><span class="ruby-operator">/</span><span class="ruby-identifier">provider_submissions</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;mobile_isps_satisfactions&#39;</span>
      <span class="ruby-identifier">provider_submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">valid_rating</span>.<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">category</span>)
      <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">provider_submissions</span>.<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">category</span>).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:rating</span>).<span class="ruby-identifier">sum</span><span class="ruby-operator">/</span><span class="ruby-identifier">provider_submissions</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">end</span>

  { <span class="ruby-identifier">categories</span><span class="ruby-operator">:</span> <span class="ruby-identifier">categories</span>, <span class="ruby-identifier">values</span><span class="ruby-operator">:</span> <span class="ruby-identifier">values</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-percentage" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">percentage</span><span
            class="method-args">(count, total_count)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="percentage-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 501</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">count</span>, <span class="ruby-identifier">total_count</span>)
  <span class="ruby-identifier">total_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">count</span><span class="ruby-operator">/</span><span class="ruby-identifier">total_count</span>.<span class="ruby-identifier">to_f</span><span class="ruby-operator">*</span><span class="ruby-value">100</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-provider_mapping" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_mapping</span><span
            class="method-args">(provider)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="provider_mapping-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 423</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">provider_mapping</span>(<span class="ruby-identifier">provider</span>)
  <span class="ruby-identifier">original_provider</span> = {
    <span class="ruby-string">&#39;AT&amp;T Services, Inc.&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;ATT&#39;</span>,
    <span class="ruby-string">&#39;AT&amp;T Data Communications Services&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;ATT&#39;</span>,
    <span class="ruby-string">&#39;IgLou Internet Services&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Iglou&#39;</span>,
    <span class="ruby-string">&#39;Level 3 Communications, Inc.&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Level 3&#39;</span>,
    <span class="ruby-string">&#39;Time Warner Cable Internet LLC&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Time Warner&#39;</span>,
    <span class="ruby-string">&#39;Windstream Communications Inc&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Windstream&#39;</span>,
  }[<span class="ruby-identifier">provider</span>]

  <span class="ruby-identifier">original_provider</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">original_provider</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">provider</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-provider_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_names</span><span
            class="method-args">(provider_ids)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="provider_names-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">provider_names</span>(<span class="ruby-identifier">provider_ids</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_ids</span> <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]
  <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">provider_ids</span>).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-satisfactions_mapping" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">satisfactions_mapping</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="satisfactions_mapping-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 701</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">satisfactions_mapping</span>(<span class="ruby-identifier">value</span>)
  {
    <span class="ruby-string">&#39;Negative&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">3.99</span>],
    <span class="ruby-string">&#39;Neutral&#39;</span>  =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">4</span><span class="ruby-operator">..</span><span class="ruby-value">5.99</span>],
    <span class="ruby-string">&#39;Positive&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">6</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>],
  }[<span class="ruby-identifier">value</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">(provider, test_type, date_range)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 296</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">search</span>(<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">test_type</span>, <span class="ruby-identifier">date_range</span>)
  <span class="ruby-identifier">date_range</span> = <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; - &#39;</span>)
  <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">utc</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">utc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">providers</span> = <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">provider</span>).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:name</span>)

  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">valid_test</span>
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">provider</span><span class="ruby-operator">:</span> <span class="ruby-identifier">providers</span>)            <span class="ruby-keyword">if</span> <span class="ruby-identifier">providers</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">mapbox_filter</span>(<span class="ruby-identifier">test_type</span>)              <span class="ruby-keyword">if</span> <span class="ruby-identifier">test_type</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>

  <span class="ruby-identifier">submissions</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-service_providers_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">service_providers_data</span><span
            class="method-args">(type, categories, connection_type, provider)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="service_providers_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 640</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">service_providers_data</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">provider</span>)
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">in_zip_code_list</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">service_providers_usage_data</span>(<span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">submissions</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;isps_usage&#39;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">service_providers_satisfactions_data</span>(<span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">submissions</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;isps_satisfactions&#39;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">mobile_service_providers_data</span>(<span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">submissions</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">in?</span>([<span class="ruby-string">&#39;mobile_isps_speeds&#39;</span>, <span class="ruby-string">&#39;mobile_isps_satisfactions&#39;</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-service_providers_satisfactions_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">service_providers_satisfactions_data</span><span
            class="method-args">(categories, connection_type, provider, submissions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="service_providers_satisfactions_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 665</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">service_providers_satisfactions_data</span>(<span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">submissions</span>)
  <span class="ruby-identifier">satisfaction_ratings</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;all&#39;</span>
    <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">valid_rating</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-identifier">connection_type</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">valid_rating</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-identifier">connection_type</span>).<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">provider</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">categories</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">category</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ratings</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_rating</span>(<span class="ruby-identifier">satisfactions_mapping</span>(<span class="ruby-identifier">category</span>)).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:rating</span>)
    <span class="ruby-identifier">entity</span> = { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">category</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">:</span> <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">ratings</span>.<span class="ruby-identifier">count</span>, <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">count</span>) }
    <span class="ruby-identifier">satisfaction_ratings</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">entity</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">satisfaction_ratings</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-service_providers_usage_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">service_providers_usage_data</span><span
            class="method-args">(categories, connection_type, submissions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="service_providers_usage_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 647</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">service_providers_usage_data</span>(<span class="ruby-identifier">categories</span>, <span class="ruby-identifier">connection_type</span>, <span class="ruby-identifier">submissions</span>)
  <span class="ruby-identifier">usage_percentages</span> = []
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-identifier">connection_type</span>)

  <span class="ruby-identifier">categories</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">category</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">category</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Other&#39;</span>
      <span class="ruby-identifier">isps_submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>.<span class="ruby-identifier">not</span>(<span class="ruby-identifier">provider</span><span class="ruby-operator">:</span> <span class="ruby-identifier">categories</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">isps_submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">category</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">entity</span> = { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">category</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">:</span> <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">isps_submissions</span>.<span class="ruby-identifier">length</span>, <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">count</span>) }
    <span class="ruby-identifier">usage_percentages</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">entity</span>
  <span class="ruby-keyword">end</span>

  { <span class="ruby-identifier">usage_percentages</span><span class="ruby-operator">:</span> <span class="ruby-identifier">usage_percentages</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_color" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_color</span><span
            class="method-args">(speed)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_color-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 348</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_color</span>(<span class="ruby-identifier">speed</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">speed</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">5.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#D73027&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">6</span><span class="ruby-operator">..</span><span class="ruby-value">17.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#FDAE61&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">18</span><span class="ruby-operator">..</span><span class="ruby-value">24.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#FFFFBF&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">25</span><span class="ruby-operator">..</span><span class="ruby-value">74.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#A6D96A&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">75</span><span class="ruby-operator">..</span><span class="ruby-value">99.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#1A9641&#39;</span>
    <span class="ruby-keyword">else</span> <span class="ruby-string">&#39;#7030A0&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_mapbox_census_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_mapbox_census_data</span><span
            class="method-args">(params, data=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_mapbox_census_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_mapbox_census_data</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">data</span>=[])
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Mechanize</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">date_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_range</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; - &#39;</span>)
  <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">utc</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">utc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">providers</span> = <span class="ruby-identifier">provider_names</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider</span>])
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] = <span class="ruby-constant">ZIP_CODES</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>] = <span class="ruby-constant">CENSUS_CODES</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]

  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">valid_test</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">provider</span><span class="ruby-operator">:</span> <span class="ruby-identifier">providers</span>)
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">with_zip_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">with_census_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">mapbox_filter_by_census_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>].<span class="ruby-identifier">present?</span>

  <span class="ruby-identifier">boundaries</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;census_boundaries&#39;</span>, <span class="ruby-identifier">expires_in</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>.<span class="ruby-identifier">hours</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">census_boundaries</span> = {}
    <span class="ruby-constant">CensusBoundary</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">area_identifier</span><span class="ruby-operator">:</span> <span class="ruby-constant">UAIs</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">boundary</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">census_boundaries</span>[<span class="ruby-identifier">boundary</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>] = { <span class="ruby-identifier">bounds</span><span class="ruby-operator">:</span> <span class="ruby-identifier">boundary</span>.<span class="ruby-identifier">bounds</span> }
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">census_boundaries</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">census_code</span>, <span class="ruby-identifier">submissions</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>])
    <span class="ruby-identifier">median_speed</span>  = <span class="ruby-identifier">median</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:&quot;#{attribute_name}&quot;</span>)).<span class="ruby-identifier">to_f</span>
    <span class="ruby-identifier">census_boundary</span> = <span class="ruby-identifier">boundaries</span>[<span class="ruby-identifier">census_code</span>.<span class="ruby-identifier">to_s</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">census_boundary</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">census_coordinates</span> = <span class="ruby-identifier">census_boundary</span>[<span class="ruby-value">:bounds</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">census_coordinates</span> = <span class="ruby-constant">CensusBoundary</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">bounds</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">feature</span> = {
                <span class="ruby-string">&#39;type&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Feature&#39;</span>,
                <span class="ruby-string">&#39;properties&#39;</span><span class="ruby-operator">:</span> {
                  <span class="ruby-string">&#39;title&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">census_code</span>,
                  <span class="ruby-string">&#39;count&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">number_with_delimiter</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">length</span>, <span class="ruby-identifier">delimiter</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;,&#39;</span>),
                  <span class="ruby-string">&#39;median_speed&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">median_speed</span>,
                  <span class="ruby-string">&#39;fast_speed&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;%.2f&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:&quot;#{attribute_name}&quot;</span>).<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">max</span>.<span class="ruby-identifier">to_f</span>,
                  <span class="ruby-string">&#39;fillColor&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;stats&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">set_stats_color</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">count</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">set_color</span>(<span class="ruby-identifier">median_speed</span>),
                  <span class="ruby-string">&#39;fillOpacity&#39;</span><span class="ruby-operator">:</span> <span class="ruby-value">0.5</span>,
                  <span class="ruby-string">&#39;weight&#39;</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>,
                  <span class="ruby-string">&#39;opacity&#39;</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>,
                  <span class="ruby-string">&#39;color&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;type&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;stats&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">set_stats_color</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">count</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">set_color</span>(<span class="ruby-identifier">median_speed</span>),
                },
                <span class="ruby-string">&#39;geometry&#39;</span><span class="ruby-operator">:</span> {
                  <span class="ruby-string">&#39;type&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Polygon&#39;</span>,
                  <span class="ruby-string">&#39;coordinates&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">census_coordinates</span>,
                }
              }

    <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">feature</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_mapbox_gl_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_mapbox_gl_data</span><span
            class="method-args">(params, data=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_mapbox_gl_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_mapbox_gl_data</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">data</span>=[])
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">search</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_range</span>])

  <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">submission</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">attribute_name</span> = <span class="ruby-node">&quot;#{params[:test_type]}_median&quot;</span>
    <span class="ruby-identifier">speed</span> = <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">attribute_name</span>)

    <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-string">&#39;type&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Feature&#39;</span>, <span class="ruby-string">&#39;properties&#39;</span><span class="ruby-operator">:</span> { <span class="ruby-string">&#39;description&#39;</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;Median #{params[:test_type].titleize} Speed: &lt;strong&gt;#{speed} Mbps&lt;/strong&gt;&quot;</span> }, <span class="ruby-string">&#39;geometry&#39;</span><span class="ruby-operator">:</span> { <span class="ruby-string">&#39;type&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Point&#39;</span>, <span class="ruby-string">&#39;coordinates&#39;</span><span class="ruby-operator">:</span> [ <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">longitude</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">latitude</span> ] } }
  <span class="ruby-keyword">end</span>

  { <span class="ruby-identifier">features</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_mapbox_markers_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_mapbox_markers_data</span><span
            class="method-args">(params, data=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_mapbox_markers_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 322</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_mapbox_markers_data</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">data</span>=[])
  <span class="ruby-identifier">submissions</span> = <span class="ruby-identifier">search</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_range</span>])

  <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">submission</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>])
    <span class="ruby-identifier">speed</span> = <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">attribute_name</span>)

    <span class="ruby-identifier">feature</span> = {
                <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{params[:test_type].titleize} Speed: &lt;strong&gt;#{speed} Mbps&lt;/strong&gt;&quot;</span>,
                <span class="ruby-identifier">geometry</span><span class="ruby-operator">:</span> {
                  <span class="ruby-identifier">latitude</span><span class="ruby-operator">:</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">latitude</span>,
                  <span class="ruby-identifier">longitude</span><span class="ruby-operator">:</span> <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">longitude</span>,
                },
                <span class="ruby-identifier">properties</span><span class="ruby-operator">:</span> {
                  <span class="ruby-string">&#39;marker-color&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">set_color</span>(<span class="ruby-identifier">speed</span>),
                  <span class="ruby-string">&#39;marker-size&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;small&#39;</span>,
                  <span class="ruby-string">&#39;marker-symbol&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;star&#39;</span>,
                }
              }

    <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">feature</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_mapbox_polygon_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_mapbox_polygon_data</span><span
            class="method-args">(params, data=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_mapbox_polygon_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_mapbox_polygon_data</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">data</span>=[])
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Mechanize</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">date_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_range</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; - &#39;</span>)
  <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">utc</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date_range</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">utc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">providers</span> = <span class="ruby-identifier">provider_names</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider</span>])
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] = <span class="ruby-constant">ZIP_CODES</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>] = <span class="ruby-constant">CENSUS_CODES</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>] <span class="ruby-operator">==</span> [<span class="ruby-string">&#39;all&#39;</span>]

  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">valid_test</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">provider</span><span class="ruby-operator">:</span> <span class="ruby-identifier">providers</span>)
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">end_date</span>)         <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">with_zip_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>])              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">with_census_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>])        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:census_code</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">polygon_data</span> = <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">mapbox_filter_by_zip_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>].<span class="ruby-identifier">present?</span>

  <span class="ruby-identifier">boundaries</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">cache</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;zip_boundaries&#39;</span>, <span class="ruby-identifier">expires_in</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>.<span class="ruby-identifier">hours</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">zip_boundaries</span> = {}
    <span class="ruby-constant">ZipBoundary</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-constant">ZIP_CODES</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">zip</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">zip_boundaries</span>[<span class="ruby-identifier">zip</span>.<span class="ruby-identifier">name</span>] = { <span class="ruby-identifier">zip_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip</span>.<span class="ruby-identifier">zip_type</span>, <span class="ruby-identifier">bounds</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip</span>.<span class="ruby-identifier">bounds</span> }
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">zip_boundaries</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">polygon_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">zip_code</span>, <span class="ruby-identifier">submissions</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:test_type</span>])
    <span class="ruby-identifier">median_speed</span>  = <span class="ruby-identifier">median</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:&quot;#{attribute_name}&quot;</span>)).<span class="ruby-identifier">to_f</span>
    <span class="ruby-identifier">zip_boundary</span> = <span class="ruby-identifier">boundaries</span>[<span class="ruby-identifier">zip_code</span>]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">zip_boundary</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">zip_coordinates</span> = <span class="ruby-identifier">zip_boundary</span>[<span class="ruby-value">:bounds</span>]
      <span class="ruby-identifier">zip_type</span> = <span class="ruby-identifier">zip_boundary</span>[<span class="ruby-value">:zip_type</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">zip_json</span> = <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">do</span>
          <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">zip_json_url</span>(<span class="ruby-identifier">zip_code</span>)).<span class="ruby-identifier">body</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">zip_json</span>[<span class="ruby-string">&#39;features&#39;</span>].<span class="ruby-identifier">blank?</span>

        <span class="ruby-identifier">zip_coordinates</span> = <span class="ruby-identifier">zip_json</span>[<span class="ruby-string">&#39;features&#39;</span>].<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;geometry&#39;</span>][<span class="ruby-string">&#39;coordinates&#39;</span>]
        <span class="ruby-identifier">zip_type</span> = <span class="ruby-identifier">zip_json</span>[<span class="ruby-string">&#39;features&#39;</span>].<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;geometry&#39;</span>][<span class="ruby-string">&#39;type&#39;</span>]

        <span class="ruby-identifier">zip</span> = <span class="ruby-constant">ZipBoundary</span>.<span class="ruby-identifier">first_or_initialize</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip_code</span>, <span class="ruby-identifier">zip_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip_type</span>)
        <span class="ruby-identifier">zip</span>.<span class="ruby-identifier">bounds</span> = <span class="ruby-identifier">zip_coordinates</span>
        <span class="ruby-identifier">zip</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">feature</span> = {
                <span class="ruby-string">&#39;type&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Feature&#39;</span>,
                <span class="ruby-string">&#39;properties&#39;</span><span class="ruby-operator">:</span> {
                  <span class="ruby-string">&#39;title&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip_code</span>,
                  <span class="ruby-string">&#39;count&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">number_with_delimiter</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">length</span>, <span class="ruby-identifier">delimiter</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;,&#39;</span>),
                  <span class="ruby-string">&#39;median_speed&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">median_speed</span>,
                  <span class="ruby-string">&#39;fast_speed&#39;</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;%.2f&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:&quot;#{attribute_name}&quot;</span>).<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">max</span>.<span class="ruby-identifier">to_f</span>,
                  <span class="ruby-string">&#39;fillColor&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">set_color</span>(<span class="ruby-identifier">median_speed</span>),
                  <span class="ruby-string">&#39;fillOpacity&#39;</span><span class="ruby-operator">:</span> <span class="ruby-value">0.5</span>,
                  <span class="ruby-string">&#39;weight&#39;</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>,
                  <span class="ruby-string">&#39;opacity&#39;</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>,
                  <span class="ruby-string">&#39;color&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">set_color</span>(<span class="ruby-identifier">median_speed</span>),
                },
                <span class="ruby-string">&#39;geometry&#39;</span><span class="ruby-operator">:</span> {
                  <span class="ruby-string">&#39;type&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip_type</span>,
                  <span class="ruby-string">&#39;coordinates&#39;</span><span class="ruby-operator">:</span> <span class="ruby-identifier">zip_coordinates</span>
                }
              }

    <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">feature</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_stats_color" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_stats_color</span><span
            class="method-args">(speed)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_stats_color-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_stats_color</span>(<span class="ruby-identifier">speed</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">speed</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">10.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#EFF3FF&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">11</span><span class="ruby-operator">..</span><span class="ruby-value">50.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#C6DBEF&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">51</span><span class="ruby-operator">..</span><span class="ruby-value">100.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#9ECAE1&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">101</span><span class="ruby-operator">..</span><span class="ruby-value">250.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#6BAED6&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">251</span><span class="ruby-operator">..</span><span class="ruby-value">500.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#4292C6&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">501</span><span class="ruby-operator">..</span><span class="ruby-value">1000.9999999999</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&#39;#2171B5&#39;</span>
    <span class="ruby-keyword">else</span> <span class="ruby-string">&#39;#084594&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-speed_attribute" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">speed_attribute</span><span
            class="method-args">(test_type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="speed_attribute-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 555</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">test_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;upload&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&#39;actual_upload_speed&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;actual_down_speed&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-speed_breakdown_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">speed_breakdown_data</span><span
            class="method-args">(submissions, statistics, providers)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="speed_breakdown_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 517</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">speed_breakdown_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">statistics</span>, <span class="ruby-identifier">providers</span>)
  <span class="ruby-identifier">speed_breakdown_ranges</span> = [<span class="ruby-string">&#39;0..5.99&#39;</span>, <span class="ruby-string">&#39;6..10.99&#39;</span>, <span class="ruby-string">&#39;11..20.99&#39;</span>, <span class="ruby-string">&#39;21..40.99&#39;</span>, <span class="ruby-string">&#39;40..60.99&#39;</span>, <span class="ruby-string">&#39;61..80.99&#39;</span>, <span class="ruby-string">&#39;81..100.99&#39;</span>, <span class="ruby-string">&#39;101..250.99&#39;</span>, <span class="ruby-string">&#39;251..500.99&#39;</span>, <span class="ruby-string">&#39;500..1000.99&#39;</span>, <span class="ruby-string">&#39;1001+&#39;</span>]
  <span class="ruby-identifier">categories</span> = []
  <span class="ruby-identifier">series</span> = []

  <span class="ruby-identifier">providers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">values</span> = []
    <span class="ruby-identifier">provider_submissions</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">provider</span>)
    <span class="ruby-identifier">speed_breakdown_ranges</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">range</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-identifier">count_between</span>(<span class="ruby-identifier">provider_submissions</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">statistics</span>[<span class="ruby-value">:test_type</span>])
      <span class="ruby-identifier">categories</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">map_range_values</span>(<span class="ruby-identifier">range</span>)
      <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">count</span>, <span class="ruby-identifier">provider_submissions</span>.<span class="ruby-identifier">count</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">series</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-identifier">values</span> }
  <span class="ruby-keyword">end</span>

  { <span class="ruby-identifier">categories</span><span class="ruby-operator">:</span> <span class="ruby-identifier">categories</span>, <span class="ruby-identifier">series</span><span class="ruby-operator">:</span> <span class="ruby-identifier">series</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-speed_comparison_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">speed_comparison_data</span><span
            class="method-args">(submissions, test_type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="speed_comparison_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 505</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">speed_comparison_data</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">attribute_name</span> = <span class="ruby-identifier">speed_attribute</span>(<span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">total_count</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">mlab_tests_count</span> = <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">from_mlab</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">less_than_5</span> = <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{attribute_name}&quot;</span><span class="ruby-operator">:</span> [<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>]).<span class="ruby-identifier">count</span>, <span class="ruby-identifier">total_count</span>)
  <span class="ruby-identifier">less_than_25</span> = <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{attribute_name}&quot;</span><span class="ruby-operator">:</span> [<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">25</span>]).<span class="ruby-identifier">count</span>, <span class="ruby-identifier">total_count</span>)
  <span class="ruby-identifier">faster_than_100</span> = <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{attribute_name} &gt;?&quot;</span>, <span class="ruby-value">100</span>).<span class="ruby-identifier">count</span>, <span class="ruby-identifier">total_count</span>)
  <span class="ruby-identifier">faster_than_250</span> = <span class="ruby-identifier">percentage</span>(<span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{attribute_name} &gt;?&quot;</span>, <span class="ruby-value">250</span>).<span class="ruby-identifier">count</span>, <span class="ruby-identifier">total_count</span>)

  { <span class="ruby-identifier">less_than_5</span><span class="ruby-operator">:</span> <span class="ruby-identifier">less_than_5</span>, <span class="ruby-identifier">less_than_25</span><span class="ruby-operator">:</span> <span class="ruby-identifier">less_than_25</span>, <span class="ruby-identifier">faster_than_100</span><span class="ruby-operator">:</span> <span class="ruby-identifier">faster_than_100</span>, <span class="ruby-identifier">faster_than_250</span><span class="ruby-operator">:</span> <span class="ruby-identifier">faster_than_250</span>, <span class="ruby-identifier">mlab_tests_count</span><span class="ruby-operator">:</span> <span class="ruby-identifier">mlab_tests_count</span>, <span class="ruby-identifier">speedup_tests_count</span><span class="ruby-operator">:</span> <span class="ruby-identifier">total_count</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">mlab_tests_count</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-stats_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stats_data</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="stats_data-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 731</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stats_data</span>
  <span class="ruby-identifier">all_results</span> = <span class="ruby-identifier">get_all_results</span>
  <span class="ruby-identifier">home_submissions</span> = <span class="ruby-identifier">in_zip_code_list</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:connection_type</span>][<span class="ruby-value">:home_wifi</span>])
  <span class="ruby-identifier">mobile_submissions</span> = <span class="ruby-identifier">in_zip_code_list</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:connection_type</span>][<span class="ruby-value">:mobile_data</span>])
  <span class="ruby-identifier">public_submissions</span> = <span class="ruby-identifier">in_zip_code_list</span>.<span class="ruby-identifier">with_connection_type</span>(<span class="ruby-constant">MAP_FILTERS</span>[<span class="ruby-value">:connection_type</span>][<span class="ruby-value">:public_wifi</span>])
  <span class="ruby-identifier">total_submissions</span> = <span class="ruby-identifier">in_zip_code_list</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">home_avg_speed_by_zipcode</span> = <span class="ruby-identifier">average_speed_by_zipcode</span>(<span class="ruby-identifier">home_submissions</span>)

  [<span class="ruby-identifier">all_results</span>, <span class="ruby-identifier">home_submissions</span>, <span class="ruby-identifier">mobile_submissions</span>, <span class="ruby-identifier">public_submissions</span>, <span class="ruby-identifier">total_submissions</span>, <span class="ruby-identifier">home_avg_speed_by_zipcode</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-testing_for_mapping" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">testing_for_mapping</span><span
            class="method-args">(testing_for)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="testing_for_mapping-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 415</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">testing_for_mapping</span>(<span class="ruby-identifier">testing_for</span>)
  {
    <span class="ruby-string">&#39;Home Wifi&#39;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Home&#39;</span>,
    <span class="ruby-string">&#39;Mobile Data&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Mobile&#39;</span>,
    <span class="ruby-string">&#39;Public Wifi&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Work/Public&#39;</span>,
  }[<span class="ruby-identifier">testing_for</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-tests_count_with_range" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tests_count_with_range</span><span
            class="method-args">(submissions, provider, range, test_type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="tests_count_with_range-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 565</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tests_count_with_range</span>(<span class="ruby-identifier">submissions</span>, <span class="ruby-identifier">provider</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">test_type</span>)
  <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-identifier">range</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">range</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">with_provider</span>(<span class="ruby-identifier">provider</span>).<span class="ruby-identifier">count</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-to_csv" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_csv</span><span
            class="method-args">(date_range)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="to_csv-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 401</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_csv</span>(<span class="ruby-identifier">date_range</span>)
  <span class="ruby-identifier">range</span> = <span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39; - &#39;</span>)
  <span class="ruby-constant">CSV</span>.<span class="ruby-identifier">generate</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">csv</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">CSV_COLUMNS</span>
    <span class="ruby-identifier">in_zip_code_list</span>.<span class="ruby-identifier">with_date_range</span>(<span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">range</span>[<span class="ruby-value">0</span>]), <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">range</span>[<span class="ruby-value">1</span>])).<span class="ruby-identifier">find_in_batches</span>(<span class="ruby-identifier">batch_size</span><span class="ruby-operator">:</span> <span class="ruby-value">1000</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">submissions</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">submissions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">submission</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">csv</span> <span class="ruby-operator">&lt;&lt;</span>  [
                  <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">source</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">created_at</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%B %d, %Y&#39;</span>), <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">created_at</span>.<span class="ruby-identifier">in_time_zone</span>(<span class="ruby-string">&#39;EST&#39;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%R %Z&#39;</span>), <span class="ruby-identifier">testing_for_mapping</span>(<span class="ruby-identifier">submission</span>.<span class="ruby-identifier">testing_for</span>), <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">zip_code</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">census_code</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">connected_with</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">monthly_price</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider_down_speed</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">rating</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">actual_down_speed</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">actual_upload_speed</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">provider_price</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">actual_price</span>, <span class="ruby-identifier">submission</span>.<span class="ruby-identifier">ping</span>
                ]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-zip_json_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">zip_json_url</span><span
            class="method-args">(zip_code)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="zip_json_url-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 388</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">zip_json_url</span>(<span class="ruby-identifier">zip_code</span>)
  <span class="ruby-identifier">api_key</span> = <span class="ruby-string">&#39;x4WYV4InzqmCGyO9rzfG7QoyiXUd1ChuG56mKgnBb3bS9O5t4wwlErW10BAqElZ9&#39;</span>
  <span class="ruby-node">&quot;https://api.maptechnica.com/v1/zip5/bounds?zip5=#{zip_code}&amp;key=#{api_key}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-calculate_average" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">calculate_average</span><span
            class="method-args">(new_value, old_value, old_count)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="calculate_average-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 717</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">calculate_average</span>(<span class="ruby-identifier">new_value</span>, <span class="ruby-identifier">old_value</span>, <span class="ruby-identifier">old_count</span>)
  (<span class="ruby-identifier">new_value</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">old_value</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">old_count</span>).<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> (<span class="ruby-identifier">old_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_actual_to_provider_difference" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_actual_to_provider_difference</span><span
            class="method-args">(actual_speed_sum, provider_speed_sum)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_actual_to_provider_difference-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 713</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_actual_to_provider_difference</span>(<span class="ruby-identifier">actual_speed_sum</span>, <span class="ruby-identifier">provider_speed_sum</span>)
  (<span class="ruby-identifier">actual_speed_sum</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">provider_speed_sum</span>).<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">provider_speed_sum</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_provider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_provider</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_provider-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 725</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_provider</span>
  <span class="ruby-identifier">ipa</span> = <span class="ruby-identifier">from_mlab?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">int_to_ip</span>(<span class="ruby-identifier">ip_address</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">ip_address</span>
  <span class="ruby-identifier">provider_obj</span> = <span class="ruby-constant">GeoIP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;GeoIPASNum.dat&#39;</span>).<span class="ruby-identifier">asn</span>(<span class="ruby-identifier">ipa</span>)
  <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">provider_mapping</span>(<span class="ruby-identifier">provider_obj</span>.<span class="ruby-identifier">asn</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_obj</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-has_required_fields-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_required_fields?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="has_required_fields-3F-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_required_fields?</span>
  [<span class="ruby-identifier">provider</span>, <span class="ruby-identifier">monthly_price</span>, <span class="ruby-identifier">provider_down_speed</span>, <span class="ruby-identifier">rating</span>].<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:present?</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-invalid_test_result" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invalid_test_result</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="invalid_test_result-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 709</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invalid_test_result</span>
  <span class="ruby-identifier">testing_for</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Mobile Data&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">actual_down_speed</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_census_code" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_census_code</span><span
            class="method-args">(latitude, longitude)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_census_code-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_census_code</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>)
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Mechanize</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">latitude</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">longitude</span>.<span class="ruby-identifier">blank?</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">response</span> = <span class="ruby-constant">Timeout</span><span class="ruby-operator">::</span><span class="ruby-identifier">timeout</span>(<span class="ruby-value">30</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">get</span>(<span class="ruby-constant">Submission</span>.<span class="ruby-identifier">census_tract_url</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>)).<span class="ruby-identifier">body</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">fips</span> = <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;Block&#39;</span>][<span class="ruby-string">&#39;FIPS&#39;</span>]
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">assign_attributes</span>(<span class="ruby-identifier">census_code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">fips</span>[<span class="ruby-value">5</span><span class="ruby-operator">..</span><span class="ruby-value">-5</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">census_status</span><span class="ruby-operator">:</span> <span class="ruby-constant">CENSUS_STATUS</span>[<span class="ruby-value">:saved</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">fips</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">census_status</span> = <span class="ruby-constant">CENSUS_STATUS</span>[<span class="ruby-value">:pending</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-source" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">source</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="source-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">source</span>
  <span class="ruby-identifier">from_mlab</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-string">&#39;MLab&#39;</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;SpeedUp&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_median_speeds_and_census" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_median_speeds_and_census</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_median_speeds_and_census-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 454</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_median_speeds_and_census</span>
  <span class="ruby-identifier">upload_speeds</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">latitude</span><span class="ruby-operator">:</span> <span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span><span class="ruby-operator">:</span> <span class="ruby-identifier">longitude</span>).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:actual_upload_speed</span>)
  <span class="ruby-identifier">download_speeds</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">latitude</span><span class="ruby-operator">:</span> <span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span><span class="ruby-operator">:</span> <span class="ruby-identifier">longitude</span>).<span class="ruby-identifier">pluck</span>(<span class="ruby-value">:actual_down_speed</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">upload_median</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">median</span> <span class="ruby-identifier">upload_speeds</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">download_median</span> = <span class="ruby-constant">Submission</span>.<span class="ruby-identifier">median</span> <span class="ruby-identifier">download_speeds</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">set_census_code</span>(<span class="ruby-identifier">latitude</span>, <span class="ruby-identifier">longitude</span>)

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_provider_statistics" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_provider_statistics</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_provider_statistics-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 436</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_provider_statistics</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">provider_name</span> = <span class="ruby-identifier">provider</span>
  <span class="ruby-identifier">provider_statistic</span> = <span class="ruby-constant">ProviderStatistic</span>.<span class="ruby-identifier">get_by_name</span>(<span class="ruby-identifier">provider_name</span>).<span class="ruby-identifier">first_or_initialize</span>
  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">from_mlab</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">persisted?</span>
  <span class="ruby-identifier">provider_applications</span> = <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">applications</span>
  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">rating</span> = <span class="ruby-identifier">calculate_average</span>(<span class="ruby-identifier">rating</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">rating</span>, <span class="ruby-identifier">provider_applications</span>)

  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">actual_speed_sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">actual_down_speed</span>.<span class="ruby-identifier">to_f</span>
  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">provider_speed_sum</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">provider_down_speed</span>.<span class="ruby-identifier">to_f</span>

  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">advertised_to_actual_ratio</span> = <span class="ruby-identifier">get_actual_to_provider_difference</span>(<span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">actual_speed_sum</span>, <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">provider_speed_sum</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">provider_speed_sum</span>.<span class="ruby-identifier">zero?</span>

  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">average_price</span> = <span class="ruby-identifier">calculate_average</span>(<span class="ruby-identifier">actual_price</span>.<span class="ruby-identifier">to_f</span>, <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">average_price</span> , <span class="ruby-identifier">provider_applications</span>)
  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">increment</span>(<span class="ruby-value">:applications</span>)
  <span class="ruby-identifier">provider_statistic</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-valid_attributes-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">valid_attributes?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="valid_attributes-3F-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">valid_attributes?</span>
  <span class="ruby-identifier">has_required_fields?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">valid_zip_code?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-valid_zip_code-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">valid_zip_code?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="valid_zip_code-3F-source">
            <pre><span class="ruby-comment"># File app/models/submission.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">valid_zip_code?</span>
  <span class="ruby-constant">ZIP_CODES</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">zip_code</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.3.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

